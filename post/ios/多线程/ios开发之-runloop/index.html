<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>iOS开发之 - RunLoop - liupengkun</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="liupengkun" />
  <meta name="description" content="以下是 RunLoop 相关的内容，前半部分是理论知识，后半部分是代码。。。 一、RunLoop 基础知识 1.1 RunLoop 简介 一般来说，一个线程只能执行一个任务，执行完就会" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.79.0" />


<link rel="canonical" href="https://liupengkun1993.github.io/post/ios/%E5%A4%9A%E7%BA%BF%E7%A8%8B/ios%E5%BC%80%E5%8F%91%E4%B9%8B-runloop/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f1e506a781bf25d33ffc18aa6b4e972a965c58049d27d4f92b7db2e9bf28e4bf.css" integrity="sha256-8eUGp4G/JdM//Biqa06XKpZcWASdJ9T5K32y6b8o5L8=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="iOS开发之 - RunLoop" />
<meta property="og:description" content="以下是 RunLoop 相关的内容，前半部分是理论知识，后半部分是代码。。。 一、RunLoop 基础知识 1.1 RunLoop 简介 一般来说，一个线程只能执行一个任务，执行完就会" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://liupengkun1993.github.io/post/ios/%E5%A4%9A%E7%BA%BF%E7%A8%8B/ios%E5%BC%80%E5%8F%91%E4%B9%8B-runloop/" />
<meta property="article:published_time" content="2016-10-22T15:43:48+08:00" />
<meta property="article:modified_time" content="2018-01-02T15:43:48+08:00" />
<meta itemprop="name" content="iOS开发之 - RunLoop">
<meta itemprop="description" content="以下是 RunLoop 相关的内容，前半部分是理论知识，后半部分是代码。。。 一、RunLoop 基础知识 1.1 RunLoop 简介 一般来说，一个线程只能执行一个任务，执行完就会">
<meta itemprop="datePublished" content="2016-10-22T15:43:48+08:00" />
<meta itemprop="dateModified" content="2018-01-02T15:43:48+08:00" />
<meta itemprop="wordCount" content="3584">



<meta itemprop="keywords" content="RunLoop,iOS," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="iOS开发之 - RunLoop"/>
<meta name="twitter:description" content="以下是 RunLoop 相关的内容，前半部分是理论知识，后半部分是代码。。。 一、RunLoop 基础知识 1.1 RunLoop 简介 一般来说，一个线程只能执行一个任务，执行完就会"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">liupengkun'Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/about/">关于</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      liupengkun'Blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/about/">关于</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">iOS开发之 - RunLoop</h1>
      
      <div class="post-meta">
        <time datetime="2016-10-22" class="post-time">
          2016-10-22
        </time>
        <div class="post-category">
            <a href="https://liupengkun1993.github.io/categories/ios/"> iOS </a>
            
          </div>
        <span class="more-meta"> 3584 words </span>
          <span class="more-meta"> 8 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一runloop-基础知识">一、RunLoop 基础知识</a>
      <ul>
        <li><a href="#11-runloop--简介">1.1 RunLoop  简介</a></li>
        <li><a href="#12-runloop的基本作用">1.2 RunLoop的基本作用</a></li>
        <li><a href="#13-runloop的使用环境">1.3 RunLoop的使用环境</a></li>
        <li><a href="#14-runloop工作的特点">1.4 RunLoop工作的特点:</a></li>
        <li><a href="#15-runloop的内部逻辑">1.5 runLoop的内部逻辑</a></li>
        <li><a href="#16-runloop与线程的关系">1.6 RunLoop与线程的关系</a></li>
        <li><a href="#17-runloop对象">1.7 RunLoop对象</a></li>
        <li><a href="#18获得-runloop-对象">1.8获得 RunLoop 对象</a></li>
        <li><a href="#19-相关类">1.9 相关类:</a></li>
        <li><a href="#110-cfrunloopsourceref-事件源输入源">1.10 CFRunLoopSourceRef 事件源(输入源)</a></li>
        <li><a href="#111-cfrunloopobserverref">1.11 CFRunLoopObserverRef</a></li>
        <li><a href="#112-runloop的模式">1.12 runLoop的模式</a></li>
      </ul>
    </li>
    <li><a href="#二演示代码">二、演示代码</a>
      <ul>
        <li><a href="#演示代码一常驻线程">演示代码一:常驻线程</a></li>
        <li><a href="#演示代码二-gcd-定时器">演示代码二: GCD 定时器:</a></li>
        <li><a href="#演示代码三观察者">演示代码三:观察者</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p><img src="http://upload-images.jianshu.io/upload_images/2665449-4d7042ab55fbe301.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="RunLoop"></p>
<blockquote>
<p>以下是 RunLoop 相关的内容，前半部分是理论知识，后半部分是代码。。。</p>
</blockquote>
<h2 id="一runloop-基础知识">一、RunLoop 基础知识</h2>
<h3 id="11-runloop--简介">1.1 RunLoop  简介</h3>
<p>一般来说，一个线程只能执行一个任务，执行完就会退出，如果我们需要一种机制，让线程能随时处理时间但并不退出，那么 RunLoop 就是这样的一个机制。Runloop是事件接收和分发机制的一个实现。所以它实际上是一个对象，这个对象管理了其需要处理的事件和消息。在iOS 系统中，有这样两个对象： NSRunLoop 和 CFRunLoopRef。 NSRunLoop 和 CFRunLoopRef都代表着 RunLoop 对象。</p>
<h3 id="12-runloop的基本作用">1.2 RunLoop的基本作用</h3>
<p>(1)保持程序的持续运行；
(2)处理 App 中的各种事件(比如触摸事件、定时器事件、Selector 事件)；
(3)节省 CPU 资源, 提高程序性能。</p>
<h3 id="13-runloop的使用环境">1.3 RunLoop的使用环境</h3>
<p>仅当在为你的程序创建辅助线程的时候，你才需要显示运行 RunLoop 。对于辅助线程，你需要判断一个 RunLoop 是否是必须的。如果是必须的，那么你要自己配置并启动它，你不需要再任何情况下都去启动一个线程的 RunLoop 。 RunLoop 在你要和线程有更多的交互时才需要，比如以下情况：
(1)使用端口或者自定义输入源来和其他线程通信；
(2)使用线程的定时器；
(3) Cocoa 中使用任何 performSelector 的方法；
(4)使线程周期性工作。</p>
<h3 id="14-runloop工作的特点">1.4 RunLoop工作的特点:</h3>
<p>(1)当有时间发生时, RunLoop 会根据具体的事件类型通知应用程序作出响应；
(2)当没有事件发生时, RunLoop 会进入休眠状态；
(3)当事件再次发生时, RunLoop 会被重新唤醒, 处理事件。</p>
<h3 id="15-runloop的内部逻辑">1.5 runLoop的内部逻辑</h3>
<p>runLoop其实是一个函数，其内部是一个 do-while 循环，当你调用CFRunLoop() 时，线程就会一直停留在这个循环中；直到超时或被手动停止，该函数才会返回。每次运行 runLoop，线程的 runLoop 会自动处理之前未处理的消息，并通知相关的观察者，具体的顺序如下：
(1)通知观察者 runLoop 已经启动；
(2)通知观察者处理将要开始的定时器；
(3)通知观察者处理即将启动的非基于端口的源；
(4)处理非基于端口的源；
(5)如果基于端口的源准备好并处于等待状态，立即启动进入步骤⑨；
(6)通知观察者线程即将进入休眠；
(7)线程处于休眠状态，直到下面的任意的一个事件发生：
A.某一时间到达基于端口的源；
B.定时器启动；
C.runLoop被外部手动唤醒；
(8)通知观察者线程刚被唤醒；
(9)处理接收到的事件，处理定时器并重启 runLoop，进入步骤2；
(10)通知观察者，即将退出 runLoop。</p>
<h3 id="16-runloop与线程的关系">1.6 RunLoop与线程的关系</h3>
<p>(1)每条线程都有唯一的一个与之对应的 RunLoop 对象；
(2)主线程的 RunLoop 已经自动创建好了, 子线程的 RunLoop 需要手动创建；
(3) RunLoop在第一次获取时创建, 在线程结束时销毁；
(4)直线线程与圆形线程：直线线程执行的任务是一条直线；而圆形线程不断循环，直到通过某种方式截止，在 iOS 中，圆形线程就是通过 runLoop 实现的。</p>
<h3 id="17-runloop对象">1.7 RunLoop对象</h3>
<p>(1) iOS中有2套 API 来访问和使用 RunLoop。
Foundation框架 : NSRunLoop；
Core Foundation框架: CFRunLoopRef。</p>
<p>(2) NSRunLoop 和 CFRunLoopRef 都代表着 RunLoop 对象 ,它们是等价的，可以互相转换；</p>
<p>(3) NSRunLoop 是基于 CFRunLoopRef 的一层 OC 包装，所以要了解 RunLoop 内部结构，需要多研究 CFRunLoopRef 层面的 API（Core Foundation层面）。</p>
<h3 id="18获得-runloop-对象">1.8获得 RunLoop 对象</h3>
<p>苹果不允许直接创建RunLoop，它只提供了两个自动获取的函数。
(1) Foundation [NSRunLoop currentRunLoop]; //获得当前线程的 RunLoop 对象
[NSRunLoop mainRunLoop]; //获得主线程的 RunLoop 对象</p>
<p>(2) Core Foundation
CFRunLoopGetCurrent(); //获得当前线程的 RunLoop 对象
CFRunLoopGetMain(); //获得主线程的 RunLoop 对象</p>
<h3 id="19-相关类">1.9 相关类:</h3>
<p>Core Foundation中关于 RunLoop 的 5 个类 ,RunLoop 如果没有这些东西, 会直接退出。
(1) CFRunLoopRef
(2) CFRunLoopModeRef 该类并没有对外暴露；
(3) CFRunLoopSourceRef
(4) CFRunLoopTimerRef
(5) CFRunLoopObserverRef</p>
<h3 id="110-cfrunloopsourceref-事件源输入源">1.10 CFRunLoopSourceRef 事件源(输入源)</h3>
<p>时间产生的地方，source 有两个版本：
(1) source0：只包含一个回调，它并不能主动触发事件，使用时，需先调用 CFRunLoopSourceSignal 将这个 source 标记为待处理，后调用 CFRunLoopWakeUp 来唤醒 runLoop，让其处理这个事件；
(2) source1：包含一个 mach_port 和一个回调，被用于通过内核和其他线程互发送消息，这种 source 能主动唤醒 runLoop 线程。</p>
<h3 id="111-cfrunloopobserverref">1.11 CFRunLoopObserverRef</h3>
<p>CFRunLoopObserverRef是观察者,能够监听 RunLoop 的状态改变,当 RunLoop 的状态发生变化时，观察者就能通过回调接受到这个变化。可以观测的时间点有以下几个：</p>
<p>kCFRunLoopEntry = (1UL &laquo; 0), // 即将进入 Loop</p>
<p>kCFRunLoopBeforeTimers = (1UL &laquo; 1), //即将处理 Timer</p>
<p>kCFRunLoopBeforeSources = (1UL &laquo; 2), //即将处理 Source</p>
<p>kCFRunLoopBeforeWaiting = (1UL &laquo; 5), //即将进入休眠</p>
<p>kCFRunLoopAfterWaiting = (1UL &laquo; 6), //刚从休眠中唤醒</p>
<p>kCFRunLoopExit = (1UL &laquo; 7), //即将退出 Loop</p>
<h3 id="112-runloop的模式">1.12 runLoop的模式</h3>
<p>runLoop 中使用 mode 来指定时间在运行循环中的优先级，系统默认注册了 5 个Mode：
(1)NSDefaultRunLoopMode（kCFRunLoopDefaultMode）:默认Mode,通常主线程是在这个Mode下运行；</p>
<p>(2) UITrackingRunLoopMode:界面跟踪Mode,用于 ScrollView 追踪触摸滑动, 保证界面滑动时不受其他 Mode 影响；</p>
<p>(3) UIInitializationRunLoopMode:启动程序后的过渡 mode，启动完成后就不再使用；</p>
<p>(4) GSEventReceiveRunLoopMode:接受系统事件的内部 Mode,通常用不到；</p>
<p>(5)kCFRunLoopCommonModes（NSRunLoopCommonModes）: 这是一个占位用的 Mode ，作为标记 DefaultMode 和CommonMode 用。</p>
<h2 id="二演示代码">二、演示代码</h2>
<h3 id="演示代码一常驻线程">演示代码一:常驻线程</h3>
<p>控制器.m中的代码:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
<span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
<span class="nb">self</span><span class="p">.</span><span class="kr">thread</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NNThread</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="nl">object</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="kr">thread</span> <span class="n">start</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark -常驻线程方式一
</span><span class="cp"></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">run</span> <span class="p">{</span>
<span class="k">@autoreleasepool</span> <span class="p">{</span>

<span class="p">[[</span><span class="n">NSRunLoop</span> <span class="n">currentRunLoop</span><span class="p">]</span> <span class="nl">addPort</span><span class="p">:[</span><span class="n">NSPort</span> <span class="n">port</span><span class="p">]</span> <span class="nl">forMode</span><span class="p">:</span><span class="n">NSDefaultRunLoopMode</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;-- run -- %@ --&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
<span class="p">[[</span><span class="n">NSRunLoop</span> <span class="n">currentRunLoop</span><span class="p">]</span> <span class="n">run</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;--不会执行--&#34;</span><span class="p">);</span> <span class="c1">// 不会执行
</span><span class="c1"></span><span class="p">}</span>
<span class="p">}</span>

<span class="cp">#pragma mark -常驻线程方式二
</span><span class="cp"></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">run1</span><span class="p">{</span>
<span class="k">@autoreleasepool</span> <span class="p">{</span>
<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="p">[[</span><span class="n">NSRunLoop</span> <span class="n">currentRunLoop</span><span class="p">]</span> <span class="n">run</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;-- run1 -- %@ --&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#pragma mark -常驻线程方式三
</span><span class="cp"></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">run2</span><span class="p">{</span>
<span class="k">@autoreleasepool</span> <span class="p">{</span>
<span class="p">[</span><span class="n">NSTimer</span> <span class="nl">scheduledTimerWithTimeInterval</span><span class="p">:</span><span class="mf">2.0</span> <span class="nl">target</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="nl">userInfo</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">repeats</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;-- run2 -- %@ --&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
<span class="p">[[</span><span class="n">NSRunLoop</span> <span class="n">currentRunLoop</span><span class="p">]</span> <span class="n">run</span><span class="p">];</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#pragma mark -在该线程中自定义事件
</span><span class="cp"></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesBegan:</span><span class="p">(</span><span class="n">NSSet</span><span class="o">&lt;</span><span class="n">UITouch</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="n">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span><span class="p">{</span>
<span class="p">[</span><span class="nb">self</span> <span class="nl">performSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="nl">onThread</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="kr">thread</span> <span class="nl">withObject</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">waitUntilDone</span><span class="p">:</span><span class="nb">NO</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">test</span> <span class="p">{</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;-- test -- %@ --&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>线程子类化:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">
<span class="cp">#import &#34;NNThread.h&#34;
</span><span class="cp"></span><span class="k">@implementation</span> <span class="nc">NNThread</span>

<span class="cp">#pragma mark -重写了 dealloc 方法,查看线程是否销毁
</span><span class="cp"></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">dealloc</span> <span class="p">{</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;线程 NNThread 被销毁&#34;</span><span class="p">);</span> <span class="c1">// 不会打印
</span><span class="c1"></span><span class="p">}</span>
<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="演示代码二-gcd-定时器">演示代码二: GCD 定时器:</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#pragma mark - GCD 的 timer
</span><span class="cp"></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesBegan:</span><span class="p">(</span><span class="n">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="n">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span>
<span class="p">{</span>
<span class="c1">//获得队列
</span><span class="c1"></span><span class="n">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_get_main_queue</span><span class="p">();</span>
<span class="c1">//创建一个定时器 (dispatch_source_t 本质还是个 OC 对象)
</span><span class="c1"></span>
<span class="nb">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span><span class="n">dispatch_source_create</span><span class="p">(</span><span class="n">DISPATCH_SOURCE_TYPE_TIMER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">queue</span><span class="p">);</span>
<span class="c1">// GCD的时间参数，一般是纳秒（1秒== 10的9次方纳秒）
</span><span class="c1"></span><span class="n">dispatch_time_t</span> <span class="n">start</span> <span class="o">=</span> <span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="n">int64_t</span><span class="p">)(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">));</span>
<span class="n">uint64_t</span> <span class="n">interval</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint64_t</span><span class="p">)(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">);</span>
<span class="n">dispatch_source_set_timer</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">timer</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">//设置回调
</span><span class="c1"></span><span class="n">dispatch_source_set_event_handler</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">timer</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;------ %@ ------&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
<span class="n">count</span><span class="o">++</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">//取消定时器
</span><span class="c1"></span><span class="n">dispatch_cancel</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">timer</span><span class="p">);</span>
<span class="nb">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">});</span>

<span class="c1">//启动定时器
</span><span class="c1"></span><span class="n">dispatch_resume</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">timer</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="演示代码三观察者">演示代码三:观察者</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#pragma mark -观察者
</span><span class="cp"></span><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">observerTest</span><span class="p">{</span>
<span class="cm">/**
</span><span class="cm">CFRunLoopObserverRef是观察者, 能够监听 RunLoop 的状态改变,当 RunLoop 的状态发生变化时，观察者就能通过回调接受到这个变化。
</span><span class="cm">
</span><span class="cm">      CFRunLoopObserverRef参数:
</span><span class="cm">第一个参数:分配存储空间
</span><span class="cm">第二个参数:监听状态
</span><span class="cm">第三个参数:是否要持续监听
</span><span class="cm">第四个参数:优先级
</span><span class="cm">第五个参数:回调
</span><span class="cm">*/</span>

<span class="c1">//创建observer
</span><span class="c1"></span><span class="n">CFRunLoopObserverRef</span> <span class="n">observer</span> <span class="o">=</span> <span class="n">CFRunLoopObserverCreateWithHandler</span><span class="p">(</span><span class="n">CFAllocatorGetDefault</span><span class="p">(),</span> <span class="n">kCFRunLoopAllActivities</span><span class="p">,</span> <span class="nb">YES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">^</span><span class="p">(</span><span class="n">CFRunLoopObserverRef</span> <span class="n">observer</span><span class="p">,</span> <span class="n">CFRunLoopActivity</span> <span class="n">activity</span><span class="p">)</span> <span class="p">{</span>
<span class="k">switch</span> <span class="p">(</span><span class="n">activity</span><span class="p">)</span> <span class="p">{</span>
<span class="k">case</span> <span class="nl">kCFRunLoopEntry</span><span class="p">:</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;即将进入runloop&#34;</span><span class="p">);</span>
<span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">kCFRunLoopBeforeTimers</span><span class="p">:</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;RunLoop即将处理 timer&#34;</span><span class="p">);</span>
<span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">kCFRunLoopBeforeSources</span><span class="p">:</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;RunLoop即将处理Sources&#34;</span><span class="p">);</span>
<span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">kCFRunLoopBeforeWaiting</span><span class="p">:</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;RunLoop即将进入休眠&#34;</span><span class="p">);</span>
<span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">kCFRunLoopAfterWaiting</span><span class="p">:</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;RunLoop刚从休眠中唤醒&#34;</span><span class="p">);</span>
<span class="k">break</span><span class="p">;</span>
<span class="k">case</span> <span class="nl">kCFRunLoopExit</span><span class="p">:</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;即将退出RunLoop &#34;</span><span class="p">);</span>
<span class="k">break</span><span class="p">;</span>
<span class="k">default</span><span class="o">:</span>
<span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">});</span>
<span class="cm">/**
</span><span class="cm">RunLoop的模式
</span><span class="cm">1.NSDefaultRunLoopMode（kCFRunLoopDefaultMode）:默认Mode,通常主线程是在这个Mode下运行
</span><span class="cm">2.UITrackingRunLoopMode:界面跟踪 Mode, 用于 ScrollView 追踪触摸滑动, 保证界面滑动时不受其他 Mode 影响
</span><span class="cm">3.UIInitializationRunLoopMode:启动程序后的过渡 mode，启动完成后就不再使用
</span><span class="cm">4.GSEventReceiveRunLoopMode:接受系统事件的内部 Mode,通常用不到
</span><span class="cm">5.kCFRunLoopCommonModes（NSRunLoopCommonModes）: 这是一个占位用的 Mode, 作为标记 DefaultMode 和 CommonMode 用
</span><span class="cm">*/</span>

<span class="cm">/**
</span><span class="cm">CFRunLoopAddObserver参数:
</span><span class="cm">第一个参数:要监听哪个RunLoop
</span><span class="cm">第二个参数:监听者
</span><span class="cm">第三个参数:要监听RunLoop在哪种运行模式下的状态
</span><span class="cm">*/</span>

<span class="c1">// 添加观察者：监听RunLoop的状态
</span><span class="c1"></span><span class="n">CFRunLoopAddObserver</span><span class="p">(</span><span class="n">CFRunLoopGetCurrent</span><span class="p">(),</span> <span class="n">observer</span><span class="p">,</span> <span class="n">kCFRunLoopDefaultMode</span><span class="p">);</span>

<span class="c1">// 释放  Observer
</span><span class="c1"></span><span class="n">CFRelease</span><span class="p">(</span><span class="n">observer</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">timerTest</span>
<span class="p">{</span>
<span class="c1">//调用了 scheduledTimer 返回的定时器，已经自动被添加到当前 RunLoop 中，默认是 NSDefaultRunLoopMode
</span><span class="c1"></span><span class="n">NSTimer</span> <span class="o">*</span><span class="n">timer</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSTimer</span> <span class="nl">scheduledTimerWithTimeInterval</span><span class="p">:</span><span class="mf">2.0</span> <span class="nl">target</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="nl">userInfo</span><span class="p">:</span><span class="nb">nil</span> <span class="nl">repeats</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>

<span class="c1">//修改模式
</span><span class="c1"></span><span class="p">[[</span><span class="n">NSRunLoop</span> <span class="n">currentRunLoop</span><span class="p">]</span> <span class="nl">addTimer</span><span class="p">:</span><span class="n">timer</span> <span class="nl">forMode</span><span class="p">:</span><span class="n">NSRunLoopCommonModes</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p><em>end</em></p>
<hr>
<p><strong>结束语：RunLoop 的总结就到此为止了，以后如果想到或遇到新知识点，会再来补充！另外如果文章写的有什么错误，烦请各位能指出来！谢谢大家！</strong></p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">liupengkun</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2018-01-02
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://liupengkun1993.github.io/tags/runloop/">RunLoop</a>
          <a href="https://liupengkun1993.github.io/tags/ios/">iOS</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/ios/tips/ios%E5%BC%80%E5%8F%91%E4%B9%8B-%E5%B9%BF%E5%91%8A%E6%A4%8D%E5%85%A5/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">iOS开发之 - 广告植入</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/ios/runtime/ios%E5%BC%80%E5%8F%91%E4%B9%8B-runtime/">
            <span class="next-text nav-default">iOS开发之 - Runtime</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:pengkun1011@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/LiuPengKun1993" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/u/3828401985?is_all=1" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/liu-peng-kun-74-8" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="https://liupengkun1993.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2016 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        liupengkun
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
