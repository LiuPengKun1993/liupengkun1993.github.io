<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(1) - liupengkun</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="liupengkun" />
  <meta name="description" content="《Effective Objective-C 2.0: 编写高质量 iOS 与 OS X 代码的 52 个有效方法》是一本非常经典的 OC 书籍。这本书从语法、接口与 API 设计、内存管理、框架等 7 大方面总" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.79.0" />


<link rel="canonical" href="http://liupengkun1993.github.io/post/ios/effective-%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F-ios-%E4%B8%8E-os-x-%E4%BB%A3%E7%A0%81%E7%9A%84-52-%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f1e506a781bf25d33ffc18aa6b4e972a965c58049d27d4f92b7db2e9bf28e4bf.css" integrity="sha256-8eUGp4G/JdM//Biqa06XKpZcWASdJ9T5K32y6b8o5L8=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(1)" />
<meta property="og:description" content="《Effective Objective-C 2.0: 编写高质量 iOS 与 OS X 代码的 52 个有效方法》是一本非常经典的 OC 书籍。这本书从语法、接口与 API 设计、内存管理、框架等 7 大方面总" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://liupengkun1993.github.io/post/ios/effective-%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F-ios-%E4%B8%8E-os-x-%E4%BB%A3%E7%A0%81%E7%9A%84-52-%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B01/" />
<meta property="article:published_time" content="2018-01-16T15:43:48+08:00" />
<meta property="article:modified_time" content="2018-11-30T15:43:48+08:00" />
<meta itemprop="name" content="iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(1)">
<meta itemprop="description" content="《Effective Objective-C 2.0: 编写高质量 iOS 与 OS X 代码的 52 个有效方法》是一本非常经典的 OC 书籍。这本书从语法、接口与 API 设计、内存管理、框架等 7 大方面总">
<meta itemprop="datePublished" content="2018-01-16T15:43:48+08:00" />
<meta itemprop="dateModified" content="2018-11-30T15:43:48+08:00" />
<meta itemprop="wordCount" content="6410">



<meta itemprop="keywords" content="读书笔记,iOS," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(1)"/>
<meta name="twitter:description" content="《Effective Objective-C 2.0: 编写高质量 iOS 与 OS X 代码的 52 个有效方法》是一本非常经典的 OC 书籍。这本书从语法、接口与 API 设计、内存管理、框架等 7 大方面总"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">liupengkun'Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/about/">关于</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      liupengkun'Blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://liupengkun1993.github.io/about/">关于</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(1)</h1>
      
      <div class="post-meta">
        <time datetime="2018-01-16" class="post-time">
          2018-01-16
        </time>
        <div class="post-category">
            <a href="http://liupengkun1993.github.io/categories/ios/"> iOS </a>
            
          </div>
        <span class="more-meta"> 6410 words </span>
          <span class="more-meta"> 13 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a>
      <ul>
        <li><a href="#文章目录">文章目录：</a></li>
      </ul>
    </li>
    <li><a href="#第-1-章熟悉-oc">第 1 章：熟悉 OC</a>
      <ul>
        <li><a href="#第-1-条---在类的头文件中尽量少引入其他头文件">第 1 条 - 在类的头文件中尽量少引入其他头文件</a></li>
        <li><a href="#第-2-条---多用字面量语法少用与之等价的方法">第 2 条 - 多用字面量语法，少用与之等价的方法</a></li>
        <li><a href="#第-3-条---多用类型常量少用-define-预处理指令">第 3 条 - 多用类型常量，少用 #define 预处理指令</a></li>
        <li><a href="#第-4-条---用枚举表示状态选项状态码">第 4 条 - 用枚举表示状态、选项、状态码</a></li>
      </ul>
    </li>
    <li><a href="#第-2-章对象消息运行期">第 2 章：对象、消息、运行期</a>
      <ul>
        <li><a href="#第-5-条---在对象内部尽量直接访问实例变量">第 5 条 - 在对象内部尽量直接访问实例变量</a></li>
        <li><a href="#第-6-条---理解对象等同性这一概念">第 6 条 - 理解“对象等同性”这一概念</a></li>
        <li><a href="#第-7-条---以类族模式隐藏实现细节">第 7 条 - 以“类族模式”隐藏实现细节</a></li>
        <li><a href="#第-8-条在既有类中使用关联对象存放自定义数据">第 8 条：在既有类中使用关联对象存放自定义数据</a></li>
        <li><a href="#第-9-条理解-objc_msgsend-的作用">第 9 条：理解 objc_msgSend 的作用</a></li>
        <li><a href="#第-10-条理解消息转发机制">第 10 条：理解消息转发机制</a></li>
        <li><a href="#第-11-条用方法调配技术调试黑盒方法">第 11 条：用“方法调配技术”调试“黑盒方法”</a></li>
        <li><a href="#第-12-条理解类对象的用意">第 12 条：理解“类对象”的用意</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <blockquote>
<p><strong>《Effective Objective-C 2.0: 编写高质量 iOS 与 OS X 代码的 52 个有效方法》是一本非常经典的 OC 书籍。这本书从语法、接口与 API 设计、内存管理、框架等 7 大方面总结和探讨了 OC 编程中的 52 个特性与陷阱，很值得读。</strong></p>
</blockquote>
<h2 id="前言">前言</h2>
<ul>
<li>文章共分为三篇：
<ul>
<li>第一篇：<a href="https://github.com/liuzhongning/Articles/blob/master/contents/previousContents/%E3%80%8AEffective%20%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F%20iOS%20%E4%B8%8E%20OS%20X%20%E4%BB%A3%E7%A0%81%E7%9A%84%2052%20%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(1).md">iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(1)</a></li>
<li>第二篇：<a href="https://github.com/liuzhongning/Articles/blob/master/contents/previousContents/%E3%80%8AEffective%20%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F%20iOS%20%E4%B8%8E%20OS%20X%20%E4%BB%A3%E7%A0%81%E7%9A%84%2052%20%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(2).md">iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(2)</a></li>
<li>第三篇：<a href="https://github.com/liuzhongning/Articles/blob/master/contents/previousContents/%E3%80%8AEffective%20%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F%20iOS%20%E4%B8%8E%20OS%20X%20%E4%BB%A3%E7%A0%81%E7%9A%84%2052%20%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(3).md">iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(3)</a></li>
</ul>
</li>
</ul>
<h3 id="文章目录">文章目录：</h3>
<ul>
<li>第 1 章：熟悉 OC</li>
<li>第 2 章：对象、消息、运行期</li>
<li>第 3 章：接口与 API 设计</li>
<li>第 4 章：协议与分类</li>
<li>第 5 章：内存管理</li>
<li>第 6 章：块与大中枢派发（block 与 GCD）</li>
<li>第 7 章：系统框架</li>
</ul>
<h2 id="第-1-章熟悉-oc">第 1 章：熟悉 OC</h2>
<h3 id="第-1-条---在类的头文件中尽量少引入其他头文件">第 1 条 - 在类的头文件中尽量少引入其他头文件</h3>
<p>OC 中应尽量避免在头文件中引用其他类，即比如我们有两个类，<code>NNListViewController</code> 以及 <code>NNHomeViewController</code>，应避免在 <code>NNListViewController.h</code> 中引用 <code>NNHomeViewController</code>，如果非要在 <code>NNListViewController.h</code> 中引入 <code>NNHomeViewController</code>，如下面代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#import &lt;UIKit/UIKit.h&gt;
</span><span class="cp"></span>
<span class="k">@interface</span> <span class="nc">NNListViewController</span> : <span class="nc">UIViewController</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">age</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="n">NNHomeViewController</span> <span class="o">*</span><span class="n">homeVC</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><p>这时程序会报错，因为 <code>NNHomeViewController</code> 类并不可见，这时常见的做法是在 <code>NNListViewController.h</code> 中加入下面这行代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#import &#34;NNHomeViewController.h&#34;
</span></code></pre></td></tr></table>
</div>
</div><p>这种方法可行，但是不够优雅。在编译 <code>NNListViewController</code> 类时，不需要知道 <code>NNHomeViewController</code> 类的全部细节，只需要知道有一个类名叫 <code>NNHomeViewController</code> 就好，所以我们应该这样写：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="k">@class</span> <span class="nc">NNHomeViewController</span>;
</code></pre></td></tr></table>
</div>
</div><p>这叫做**“向前声明”该类**。现在 <code>NNListViewController.h</code> 变成了这样：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#import &lt;UIKit/UIKit.h&gt;
</span><span class="cp"></span>
<span class="k">@class</span> <span class="nc">NNHomeViewController</span>;

<span class="k">@interface</span> <span class="nc">NNListViewController</span> : <span class="nc">UIViewController</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">age</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="n">NNHomeViewController</span> <span class="o">*</span><span class="n">homeVC</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><p><code>NNListViewController</code> 的实现文件需要引入 <code>NNHomeViewController.h</code>，因为若要使用后者，就必须知道其所有接口细节。于是 <code>NNListViewController.m</code> 就是：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#import &#34;NNListViewController.h&#34;
</span><span class="cp">#import &#34;NNHomeViewController.h&#34;
</span><span class="cp"></span>
<span class="k">@implementation</span> <span class="nc">NNListViewController</span>

<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>利用向前声明这种写法，有两个好处：
<ol>
<li>减少编译时间。在头文件中使用向前声明，不会引入 <code>NNHomeViewController</code> 中的所有内容，只在确有需要的时候才引入，这样会缩减编译时间。</li>
<li>解决了两个类互相引用的问题。假设 <code>NNHomeViewController</code> 类与 <code>NNListViewController</code> 类互相引用，使用 <code>#import</code> 而非 <code>#include</code> 指令虽然不会造成死循环，但会使两个类里有一个无法被正确编译。这个时候我们使用向前声明，就可以解决这个问题。</li>
</ol>
</li>
</ul>
<h3 id="第-2-条---多用字面量语法少用与之等价的方法">第 2 条 - 多用字面量语法，少用与之等价的方法</h3>
<p>编写 OC 代码总会用到几个类，<code>NSString</code>、<code>NSArray</code>、<code>NSNumber</code>、<code>NSDictionary</code>，从类名上即可看出各自所表达的数据结构。<code>NSString</code> 对象有一种简单的创建方式，叫做“字符串字面量”，其语法如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="n">NSString</span> <span class="n">string</span> <span class="o">=</span> <span class="s">@&#34;Liu Zhong Ning&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>如果不用这种语法，就要以常见的<code> alloc</code> 及 <code>init</code> 方法来分配并初始化 <code>NSString</code> 对象了。同样也能用字面量语法声明 <code>NSArray</code>、<code>NSNumber</code>、<code>NSDictionary</code> 类的实例。<strong>使用字面量语法可以缩减代码长度，使其更为易读。</strong></p>
<ul>
<li>非字面量语法：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">    <span class="c1">// NSNumber
</span><span class="c1"></span>    <span class="n">NSNumber</span> <span class="o">*</span><span class="n">intNumber</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">NSNumber</span> <span class="o">*</span><span class="n">floatNumber</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithFloat</span><span class="p">:</span><span class="mf">6.6f</span><span class="p">];</span>
    <span class="n">NSNumber</span> <span class="o">*</span><span class="n">charNumber</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNumber</span> <span class="nl">numberWithChar</span><span class="p">:</span><span class="sc">&#39;a&#39;</span><span class="p">];</span>

    <span class="c1">// NSArray
</span><span class="c1"></span>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">animals</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSArray</span> <span class="nl">arrayWithObjects</span><span class="p">:</span><span class="s">@&#34;cat&#34;</span><span class="p">,</span> <span class="s">@&#34;dog&#34;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
    <span class="c1">// 取下标
</span><span class="c1"></span>    <span class="n">NSString</span> <span class="o">*</span><span class="n">dog</span> <span class="o">=</span> <span class="p">[</span><span class="n">animals</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>

    <span class="c1">// NSDictionary
</span><span class="c1"></span>    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">personDic</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="nl">dictionaryWithObjectsAndKeys</span><span class="p">:</span><span class="s">@&#34;Liu Zhong Ning&#34;</span><span class="p">,</span> <span class="s">@&#34;name&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s">@&#34;age&#34;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
    <span class="c1">// 访问字典
</span><span class="c1"></span>    <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="n">personDic</span> <span class="nl">objectForKey</span><span class="p">:</span><span class="s">@&#34;name&#34;</span><span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>字面量语法：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">    <span class="c1">// NSNumber
</span><span class="c1"></span>    <span class="n">NSNumber</span> <span class="o">*</span><span class="n">intNumber</span> <span class="o">=</span> <span class="mi">@1</span><span class="p">;</span>
    <span class="n">NSNumber</span> <span class="o">*</span><span class="n">floatNumber</span> <span class="o">=</span> <span class="mf">@6.6f</span><span class="p">;</span>
    <span class="n">NSNumber</span> <span class="o">*</span><span class="n">charNumber</span> <span class="o">=</span> <span class="sc">@&#39;a&#39;</span><span class="p">;</span>

    <span class="c1">// NSArray
</span><span class="c1"></span>    <span class="n">NSArray</span> <span class="o">*</span><span class="n">animals</span> <span class="o">=</span> <span class="l">@[</span><span class="s">@&#34;cat&#34;</span><span class="p">,</span> <span class="s">@&#34;dog&#34;</span><span class="l">]</span><span class="p">;</span>
    <span class="c1">// 取下标
</span><span class="c1"></span>    <span class="n">NSString</span> <span class="o">*</span><span class="n">dog</span> <span class="o">=</span> <span class="n">animals</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

    <span class="c1">// NSDictionary
</span><span class="c1"></span>    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">personDic</span> <span class="o">=</span> <span class="l">@{</span><span class="s">@&#34;name&#34;</span> <span class="o">:</span> <span class="s">@&#34;Liu Zhong Ning&#34;</span><span class="p">,</span>
                                <span class="s">@&#34;age&#34;</span> <span class="o">:</span> <span class="mi">@25</span><span class="l">}</span><span class="p">;</span>
    <span class="c1">// 访问字典
</span><span class="c1"></span>    <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">personDic</span><span class="p">[</span><span class="s">@&#34;name&#34;</span><span class="p">];</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>注意点：用字面量语法创建数组或字典时，若值中有 <code>nil</code>，则会抛出异常。因此，务必确保值里不包含 <code>nil</code>。</li>
</ul>
<h3 id="第-3-条---多用类型常量少用-define-预处理指令">第 3 条 - 多用类型常量，少用 #define 预处理指令</h3>
<ul>
<li>定义常量时，有时会用这种方法：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#define ANIMATION_DURATION 0.3
</span></code></pre></td></tr></table>
</div>
</div><p>用预处理指令也可以达到我们想要的效果，但这样定义出来的常量 <strong>没有类型信息</strong>；
另外，预处理过程会把碰到的所有 <code>ANIMATION_DURATION</code> 换成 0.3，这样的话，假设此指令声明在某头文件，那么 <strong>所有引入了这个头文件的代码，其<code> ANIMATION_DURATION</code> 都会被替换</strong>。有个办法比用预处理指令来定义常量更好：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="k">static</span> <span class="k">const</span> <span class="n">NSTimeInterval</span> <span class="n">kAnimationDuration</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>可以看出，上面方式定义的常量包含类型信息，可知该常量类型为 <code>NSTimeInterval</code>，这种方式能令阅读代码的人更易理解其意图。另外还应注意常量名称：若常量只用在实现文件，则在前面加字母 <code>k</code>；若常量在类之外可见，则通常以类名为前缀。</p>
<p>**变量一定要同时用 <code>static</code> 与 <code>const</code> 来声明。如果试图修改由 <code>const</code> 修饰符所声明的变量，那么编译器就会报错。而 <code>static</code> 修饰符意味着该变量仅在定义此变量的实现文件中可见。**如果不加 <code>static</code>，则编译器会为它创建一个“外部符号”，此时若另一个类中也声明了同名变量，那么编译器就会抛出一条错误消息。</p>
<ul>
<li>要点：
<ul>
<li>**不要用预处理指令定义常量。**这样定义出来的常量不含类型信息，编译器只是会在编译前执行查找与替换操作。即使有人重新定义了常量值，编译器也不会产生警告信息，这将导致应用程序中的常量值不一致。</li>
<li>**在实现文件中使用 <code>static const</code> 定义“只在编译单元内可见的常量”。**由于此类常量不再全局符号表中，所以无须为其名称加前缀。</li>
</ul>
</li>
</ul>
<h3 id="第-4-条---用枚举表示状态选项状态码">第 4 条 - 用枚举表示状态、选项、状态码</h3>
<ul>
<li><strong>枚举是一种常量命名方式。当一个对象如果有多种状态时，就可以定义为一个枚举集。</strong></li>
</ul>
<p>比如<code> UITableView</code> 中的 <code>UITableViewStyle</code> 就是一个枚举：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">,</span> <span class="n">UITableViewStyle</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UITableViewStylePlain</span><span class="p">,</span>          <span class="c1">// regular table view
</span><span class="c1"></span>    <span class="n">UITableViewStyleGrouped</span>         <span class="c1">// preferences style table view
</span><span class="c1"></span><span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>由于每种状态都用一个便于理解的值来表示，所以这样写出来的代码更易读懂。编译器会为枚举分配一个独有的编号，从 <code>0</code> 开始，每个枚举递增 <code>1</code>。</strong></p>
<ul>
<li>在 switch 中使用枚举：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">    <span class="c1">// 定义
</span><span class="c1"></span>    <span class="k">typedef</span> <span class="k">enum</span> <span class="o">:</span> <span class="n">NSUInteger</span> <span class="p">{</span>
        <span class="n">NNAccountStateInitial</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>        <span class="c1">// 初始
</span><span class="c1"></span>        <span class="n">NNAccountStateWaitReviewed</span><span class="p">,</span>       <span class="c1">// 待审核
</span><span class="c1"></span>        <span class="n">NNAccountStatePassed</span><span class="p">,</span>             <span class="c1">// 已通过
</span><span class="c1"></span>        <span class="n">NNAccountStateNoPassed</span><span class="p">,</span>           <span class="c1">// 未通过
</span><span class="c1"></span>        <span class="n">NNAccountStateDeactivated</span><span class="p">,</span>        <span class="c1">// 停用
</span><span class="c1"></span>        <span class="n">NNAccountStateFreeze</span><span class="p">,</span>             <span class="c1">// 冻结
</span><span class="c1"></span>    <span class="p">}</span> <span class="n">NNAccountState</span><span class="p">;</span>

    <span class="c1">// 使用
</span><span class="c1"></span>    <span class="k">switch</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">accountState</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">NNAccountStateInitial</span><span class="p">:</span>
            
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateWaitReviewed</span><span class="p">:</span>
            
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStatePassed</span><span class="p">:</span>
            
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateNoPassed</span><span class="p">:</span>
            
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateDeactivated</span><span class="p">:</span>
            
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateFreeze</span><span class="p">:</span>
            
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>要点：
<ul>
<li>应该用枚举表示状态，给这些值起个易懂的名字。</li>
<li>在处理枚举类型的 <code>switch</code> 语句中，不要实现 <code>default</code> 分支，这样，加入新枚举之后，编译器就会提示开发者：<code>switch</code> 语句并未处理所有的枚举。</li>
</ul>
</li>
</ul>
<h2 id="第-2-章对象消息运行期">第 2 章：对象、消息、运行期</h2>
<h3 id="第-5-条---在对象内部尽量直接访问实例变量">第 5 条 - 在对象内部尽量直接访问实例变量</h3>
<p>请看下边这个类。</p>
<p>.h 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#import &lt;UIKit/UIKit.h&gt;
</span><span class="cp"></span>
<span class="k">@interface</span> <span class="nc">NNListViewController</span> : <span class="nc">UIViewController</span>

<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">lastName</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">firstName</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">fullName</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setFullName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fullName</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><p>.m 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="k">@implementation</span> <span class="nc">NNListViewController</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">fullName</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&#34;%@ %@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">firstName</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">lastName</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setFullName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fullName</span> <span class="p">{</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">compoents</span> <span class="o">=</span> <span class="p">[</span><span class="n">fullName</span> <span class="nl">componentsSeparatedByString</span><span class="p">:</span><span class="s">@&#34; &#34;</span><span class="p">];</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">firstName</span> <span class="o">=</span> <span class="p">[</span><span class="n">compoents</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">firstName</span> <span class="o">=</span> <span class="p">[</span><span class="n">compoents</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><p>在 fullName 的获取方法与设置方法中，我们使用点语法，通过存取方法来访问相关的实例变量。现在假设重写这两个方法，不经由存取方法，而是直接访问实例变量：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="p">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">fullName</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&#34;%@ %@&#34;</span><span class="p">,</span> <span class="n">_firstName</span><span class="p">,</span> <span class="n">_lastName</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setFullName:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">fullName</span> <span class="p">{</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">compoents</span> <span class="o">=</span> <span class="p">[</span><span class="n">fullName</span> <span class="nl">componentsSeparatedByString</span><span class="p">:</span><span class="s">@&#34; &#34;</span><span class="p">];</span>
    <span class="n">_firstName</span> <span class="o">=</span> <span class="p">[</span><span class="n">compoents</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">_firstName</span> <span class="o">=</span> <span class="p">[</span><span class="n">compoents</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>这两种写法有几个区别：
<ul>
<li>由于不经过 <code>OC</code> 方法派发步骤，所以直接访问实例变量的速度当然比较快，在这种情况下，编译器所生成的代码会直接访问保存对象实例变量的那块内存。</li>
<li>直接访问实例变量不会调用其“设置方法”，这就绕过了为相关属性所定义的“内存管理语义”。比方说，如果在 <code>ARC</code> 下直接访问一个声明为 <code>copy</code> 的属性，那么并不会拷贝该属性，只会保留新值并释放旧值。</li>
<li>如果直接访问实例变量，那么不会触发“键值观测”通知，这样做是否会产生问题，还取决于具体的对象行为。</li>
<li>通过属性来访问有助于排查与之相关的错误，因为可以给“获取方法”或“设置方法”中新增“断点”，监控该属性的调用者及其访问时机。</li>
</ul>
</li>
</ul>
<h3 id="第-6-条---理解对象等同性这一概念">第 6 条 - 理解“对象等同性”这一概念</h3>
<p>根据“等同性”来比较对象是一个非常有用的功能，请看下面这段代码，并思考会输出什么：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">    <span class="n">NSString</span> <span class="o">*</span><span class="n">foo</span> <span class="o">=</span> <span class="s">@&#34;Badger 123&#34;</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">bar</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&#34;Badger %d&#34;</span><span class="p">,</span> <span class="mi">123</span><span class="p">];</span>
    <span class="kt">BOOL</span> <span class="n">equalA</span> <span class="o">=</span> <span class="p">(</span><span class="n">foo</span> <span class="o">==</span> <span class="n">bar</span><span class="p">);</span>
    <span class="kt">BOOL</span> <span class="n">equalB</span> <span class="o">=</span> <span class="p">[</span><span class="n">foo</span> <span class="nl">isEqual</span><span class="p">:</span><span class="n">bar</span><span class="p">];</span>
    <span class="kt">BOOL</span> <span class="n">equalC</span> <span class="o">=</span> <span class="p">[</span><span class="n">foo</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="n">bar</span><span class="p">];</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;equalA = %d, equalB = %d, equalC = %d&#34;</span><span class="p">,</span> <span class="n">equalA</span><span class="p">,</span> <span class="n">equalB</span><span class="p">,</span> <span class="n">equalC</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>这里是输出结果：<code>equalA = 0, equalB = 1, equalC = 1</code></p>
<p>大家可以看到 == 与等同性判断方法之间的差别(== 操作符只是比较了两个指针，而不是指针所指的对象)，NSString 实现了一个自己独有的判断方法，isEqualToString。调用该方法比调用 isEqual 方法快，后者还要执行额外的步骤，因此它不知道受测对象的类型。</p>
<h3 id="第-7-条---以类族模式隐藏实现细节">第 7 条 - 以“类族模式”隐藏实现细节</h3>
<p>“类族”是一种很有用的模式，可以隐藏“抽象基类”背后的实现细节。<code>OC</code> 的系统框架中普遍使用此模式。比如创建 <code>UIButton</code> 时需要调用下面这个方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">buttonWithType:</span><span class="p">(</span><span class="n">UIButtonType</span><span class="p">)</span><span class="nv">buttonType</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>该方法所返回的对象，其类型取决于传入的按钮类型，然而，不管返回什么类型的对象，它们都继承自同一个基类：<code>UIButton</code>。这么做的意义在于：<code>UIButton</code> 类的使用者无须关心创建出来的按钮具体属于哪个子类，也不用考虑按钮的绘制方式等实现细节。</p>
<ul>
<li>举例创建类族</li>
</ul>
<p>.h 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#import &lt;UIKit/UIKit.h&gt;
</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="o">:</span> <span class="n">NSUInteger</span> <span class="p">{</span>
    <span class="n">NNAccountStateInitial</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>        <span class="c1">// 初始
</span><span class="c1"></span>    <span class="n">NNAccountStateWaitReviewed</span><span class="p">,</span>       <span class="c1">// 待审核
</span><span class="c1"></span>    <span class="n">NNAccountStatePassed</span><span class="p">,</span>             <span class="c1">// 已通过
</span><span class="c1"></span>    <span class="n">NNAccountStateNoPassed</span><span class="p">,</span>           <span class="c1">// 未通过
</span><span class="c1"></span>    <span class="n">NNAccountStateDeactivated</span><span class="p">,</span>        <span class="c1">// 停用
</span><span class="c1"></span>    <span class="n">NNAccountStateFreeze</span><span class="p">,</span>             <span class="c1">// 冻结
</span><span class="c1"></span><span class="p">}</span> <span class="n">NNAccountState</span><span class="p">;</span>

<span class="k">@interface</span> <span class="nc">NNHomeViewController</span> : <span class="nc">UIViewController</span>

<span class="p">+</span> <span class="p">(</span><span class="n">NNHomeViewController</span> <span class="o">*</span><span class="p">)</span><span class="nf">accountWithState:</span><span class="p">(</span><span class="n">NNAccountState</span><span class="p">)</span><span class="nv">state</span><span class="p">;</span>

<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><p>.m 文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="p">+</span> <span class="p">(</span><span class="n">NNHomeViewController</span> <span class="o">*</span><span class="p">)</span><span class="nf">accountWithState:</span><span class="p">(</span><span class="n">NNAccountState</span><span class="p">)</span><span class="nv">state</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">NNAccountStateInitial</span><span class="p">:</span>
            <span class="c1">// 做操作
</span><span class="c1"></span>            <span class="k">return</span> <span class="p">[[</span><span class="n">NNHomeViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateWaitReviewed</span><span class="p">:</span>
            <span class="c1">// 做操作
</span><span class="c1"></span>            <span class="k">return</span> <span class="p">[[</span><span class="n">NNHomeViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStatePassed</span><span class="p">:</span>
            <span class="c1">// 做操作
</span><span class="c1"></span>            <span class="k">return</span> <span class="p">[[</span><span class="n">NNHomeViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateNoPassed</span><span class="p">:</span>
            <span class="c1">// 做操作
</span><span class="c1"></span>            <span class="k">return</span> <span class="p">[[</span><span class="n">NNHomeViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateDeactivated</span><span class="p">:</span>
            <span class="c1">// 做操作
</span><span class="c1"></span>            <span class="k">return</span> <span class="p">[[</span><span class="n">NNHomeViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nl">NNAccountStateFreeze</span><span class="p">:</span>
            <span class="c1">// 做操作
</span><span class="c1"></span>            <span class="k">return</span> <span class="p">[[</span><span class="n">NNHomeViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Cocoa 里的类族
系统框架中有许多类族。大部分<code> collection</code> 类都是类族，例如 <code>NSArray</code> 与其可变版本 <code>NSMutableArray</code>。这样看来，实际上有两个抽象基类，一个用于不可变数组，一个用于可变数组。尽管具备公共接口的类有两个，但仍然可以合起来算作一个类族。不可变的类定义了对所有数组都通用的方法，而可变的类则定义了那些只适用于可变数组的方法。两个类共属于一类族，这意味着二者在实现各自类型的数组时可以共用实现代码，此外，还能够把可变数组复制为不可变数组，反之亦然。</p>
</li>
<li>
<p>请看下面这句代码:</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">    <span class="kt">id</span> <span class="n">maybeAnArray</span><span class="p">;</span>
    <span class="c1">// 可以对 maybeAnArray 赋任何值
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">([</span><span class="n">maybeAnArray</span> <span class="k">class</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="n">NSArray</span> <span class="k">class</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// 判断永远不会为真
</span><span class="c1"></span>        <span class="c1">// 不会执行
</span><span class="c1"></span>    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>解析代码：<code>NSArray</code> 是个类族，<code>[maybeAnArray class]</code> 所返回的绝不可能是 <code>NSArray</code> 本身，因为由 <code>NSArray</code> 的初始化方法所返回的那个实例其类型是隐藏在类族公共接口后面的某个内部类型。
不过仍然有办法可以判断出某个实例所属的类是否位于类族之中。若想判断某对象是否位于类族中，不要直接检测两个类对象是否相同，而应该采用下列代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">    <span class="kt">id</span> <span class="n">maybeAnArray</span><span class="p">;</span>
    <span class="c1">// 对 maybeAnArray 赋任何值
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">([</span><span class="n">maybeAnArray</span> <span class="nl">isKindOfClass</span><span class="p">:[</span><span class="n">NSArray</span> <span class="k">class</span><span class="p">]])</span> <span class="p">{</span>
        <span class="c1">// 会执行
</span><span class="c1"></span>    <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="第-8-条在既有类中使用关联对象存放自定义数据">第 8 条：在既有类中使用关联对象存放自定义数据</h3>
<p>在 OC 中可以通过 Category 给一个现有的类添加属性，但却不能添加实例变量，这似乎成为了 OC 的一个短板。值得庆幸的是，<code>OC</code> 中有一项强大的特性可以解决此问题，这就是关联对象<code>（Associated Object）</code>。</p>
<ul>
<li>看下这几个方法：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc">    <span class="c1">// 需要导入头文件
</span><span class="c1"></span>    <span class="cp">#import &lt;objc/runtime.h&gt;
</span><span class="cp"></span>
    <span class="c1">// 根据给定的键和策略为某对象设置关联对象值
</span><span class="c1"></span>    <span class="n">OBJC_EXPORT</span> <span class="kt">void</span> <span class="nf">objc_setAssociatedObject</span><span class="p">(</span><span class="kt">id</span> <span class="n">object</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">id</span> <span class="n">value</span><span class="p">,</span> <span class="n">objc_AssociationPolicy</span> <span class="n">policy</span><span class="p">);</span>
    <span class="c1">// 根据给定的键从某对象获取相应的关联对象值
</span><span class="c1"></span>    <span class="n">OBJC_EXPORT</span> <span class="kt">id</span> <span class="nf">objc_getAssociatedObject</span><span class="p">(</span><span class="kt">id</span> <span class="n">object</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>
    <span class="c1">// 移除指定对象的全部关联对象
</span><span class="c1"></span>    <span class="n">OBJC_EXPORT</span> <span class="kt">void</span> <span class="nf">objc_removeAssociatedObjects</span><span class="p">(</span><span class="kt">id</span> <span class="n">object</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>解析代码：<code>id object</code>给谁设置关联对象；<code>const void *key</code>关联对象唯一的 key ，获取时会用到的主键；<code>id value</code>关联对象；<code>objc_AssociationPolicy</code>关联策略，关联策略以下几种：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="k">typedef</span> <span class="nf">OBJC_ENUM</span><span class="p">(</span><span class="n">uintptr_t</span><span class="p">,</span> <span class="n">objc_AssociationPolicy</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">OBJC_ASSOCIATION_ASSIGN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>           <span class="cm">/**&lt; Specifies a weak reference to the associated object. */</span>
    <span class="n">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="cm">/**&lt; Specifies a strong reference to the associated object. 
</span><span class="cm">                                            *   The association is not made atomically. */</span>
    <span class="n">OBJC_ASSOCIATION_COPY_NONATOMIC</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>   <span class="cm">/**&lt; Specifies that the associated object is copied. 
</span><span class="cm">                                            *   The association is not made atomically. */</span>
    <span class="n">OBJC_ASSOCIATION_RETAIN</span> <span class="o">=</span> <span class="mo">01401</span><span class="p">,</span>       <span class="cm">/**&lt; Specifies a strong reference to the associated object.
</span><span class="cm">                                            *   The association is made atomically. */</span>
    <span class="n">OBJC_ASSOCIATION_COPY</span> <span class="o">=</span> <span class="mo">01403</span>          <span class="cm">/**&lt; Specifies that the associated object is copied.
</span><span class="cm">                                            *   The association is made atomically. */</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div><p>关联对象有很多细节很多坑需要注意，想了解更多关联对象的童鞋请看这篇文章：<a href="http://blog.csdn.net/shaobo8910/article/details/47748727">Objective-C Associated Objects 的实现原理。</a></p>
<h3 id="第-9-条理解-objc_msgsend-的作用">第 9 条：理解 objc_msgSend 的作用</h3>
<p>在 OC 中，如果向某个对象传递消息，那就会在运行时使用动态绑定<code>（dynamic binding）</code>机制来决定需要调用的方法。但是到了底层具体实现，却是普通的C语言函数实现的。这个实现的函数就是<code>objc_msgSend</code>,该函数定义如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="kt">void</span> <span class="n">objc_msgSend</span><span class="p">(</span><span class="kt">id</span> <span class="nb">self</span><span class="p">,</span> <span class="kt">SEL</span> <span class="n">cmd</span><span class="p">,</span> <span class="p">...)</span> 
</code></pre></td></tr></table>
</div>
</div><p>第一个参数代表<code>接收者</code>，第二个参数代表<code>选择子</code>（<code>SEL是选择子的类型，选择子即方法名字</code>），后续参数就是消息中的那些<code>参数</code>，其顺序不变。</p>
<ul>
<li>举个例子:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="kt">id</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="p">[</span><span class="n">someObject</span> <span class="nl">messageName</span><span class="p">:</span><span class="n">parameter</span><span class="p">];</span> 
</code></pre></td></tr></table>
</div>
</div><p>代码解析：<code>objc_msgSend</code> 函数会依据接收者与选择子的类型来调用适当的方法。函数首先会在接收者所属的类中搜寻其方法列表，如果能找到这个跟选择子名称相同的方法，就跳转至其实现代码。若是当前类没找到，那就沿着继承体系向上查找，等找到合适方法之后再跳转 ，如果最终还是找不到，那就进入消息转发的流程去进行处理了。</p>
<h3 id="第-10-条理解消息转发机制">第 10 条：理解消息转发机制</h3>
<p><strong>当对象接收到无法解读的消息后，就会启动“消息转发”<code>（message forwarding）</code>机制</strong>，我们可以通过代码在消息转发的过程中告诉对象应该如何处理未知的消息，系统默认是抛出异常，控制台给出提示代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="n">unrecognized</span> <span class="n">selector</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">instance</span> <span class="mh">0x7f8c8a70a380</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>消息转发机制所讲的就是在抛出异常之前也就是消息转发过程中经过的一些步骤。</strong></p>
<h5 id="消息转发机制分为两个阶段">消息转发机制分为两个阶段：</h5>
<ul>
<li>
<p>第一阶段先征询接收者，所属的类，看其是否能动态添加方法，以处理当前这个“未知的选择子”<code>（unknown selector）</code>，这叫做“动态方法解析”<code>（dynamic method resolution）</code>。</p>
</li>
<li>
<p>第二阶段涉及“完整的消息转发机制”<code>（full forwarding mechanism）</code>。如果运行期系统已经把第一阶段执行完了，那么接收者自己就无法再以动态新增方法的手段来响应包含该选择子的消息了。此时，运行期系统会请求接收者以其他手段来处理与消息相关的方法调用。这又细分为两小步。</p>
<ul>
<li>首先，请接收者看看有没有其他对象能处理这条消息。</li>
<li>若有，则运行期系统会把消息转给那个对象，于是消息转发过程结束，一切如常。若没有“备援的接收者”<code>（replacement receiver）</code>，则启动完整的消息转发机制，运行期系统会把与消息有关的全部细节都封装到 <code>NSInvocation</code> 对象中，再给接收者最后一次机会，令其设法解决当前还未处理的这条消息。</li>
</ul>
</li>
<li>
<p>消息转发全流程：</p>
</li>
</ul>
<p><img src="/image/iOS/iOS_Effective/iOS_Effective01.jpeg" alt="消息转发全流程"></p>
<h3 id="第-11-条用方法调配技术调试黑盒方法">第 11 条：用“方法调配技术”调试“黑盒方法”</h3>
<p>这条讲的主要内容就是方法调配<code>( Method Swizzling)</code>，通过运行时用另外一种方法实现来替换掉原有的方法实现，往往被应用在向原有实现中添加新功能，打印信息等。</p>
<ul>
<li>如何互换两个方法实现？具体主要用下面两个方法</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="kt">Class</span> <span class="n">_Nullable</span> <span class="n">cls</span><span class="p">,</span> <span class="kt">SEL</span> <span class="n">_Nonnull</span> <span class="n">name</span><span class="p">)</span>
<span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">Method</span> <span class="n">_Nonnull</span> <span class="n">m1</span><span class="p">,</span> <span class="n">Method</span> <span class="n">_Nonnull</span> <span class="n">m2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>首先我们写一个分类，比如为<code>NSString</code>写一个“分类”<code>（category）</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="cp">#import &#34;NSString+extension.h&#34;
</span><span class="cp">#import &lt;objc/runtime.h&gt;
</span><span class="cp"></span>
<span class="k">@implementation</span> <span class="nc">NSString</span> <span class="nl">(extension)</span>

<span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">load</span> <span class="p">{</span>
    <span class="n">Method</span> <span class="n">oldMethod</span> <span class="o">=</span> <span class="n">class_getInstanceMethod</span><span class="p">([</span><span class="n">NSString</span> <span class="k">class</span><span class="p">],</span> <span class="k">@selector</span><span class="p">(</span><span class="n">lowercaseString</span><span class="p">));</span>
    <span class="n">Method</span> <span class="n">newMethod</span> <span class="o">=</span> <span class="n">class_getInstanceMethod</span><span class="p">([</span><span class="n">NSString</span> <span class="k">class</span><span class="p">],</span> <span class="k">@selector</span><span class="p">(</span><span class="n">new_lowercaseString</span><span class="p">));</span>
    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">oldMethod</span><span class="p">,</span> <span class="n">newMethod</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nf">new_lowercaseString</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">lowerString</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="n">new_myLowercaseString</span><span class="p">];</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@ - %@&#34;</span><span class="p">,</span> <span class="nb">self</span><span class="p">,</span> <span class="n">lowerString</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">lowerString</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></td></tr></table>
</div>
</div><p>解析代码：<code>+ (void)load</code>中会调换<code>lowercaseString</code>方法与<code>new_lowercaseString</code>方法；在方法<code>- (NSString *)new_lowercaseString</code>中，<code> [self new_myLowercaseString]</code>，我们调用<code>new_myLowercaseString</code>方法，此时不会引起死循环，因为这个方法是与<code>lowercaseString</code>方法调换的。</p>
<p>此时我们在<code>NSString</code>实例中调用<code>lowercaseString</code>方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="s">@&#34;Talk is cheap, Show me the code.&#34;</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">lowercaseString</span> <span class="o">=</span> <span class="p">[</span><span class="n">string</span> <span class="n">lowercaseString</span><span class="p">];</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&#34;%@&#34;</span><span class="p">,</span> <span class="n">lowercaseString</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>打印效果图如下：</p>
<p><img src="/image/iOS/iOS_Effective/iOS_Effective02.png" alt=""></p>
<p>通过此方案，开发者可以为那些“完全不知道其具体实现的”<code>（completely opaque，“完全不透明的”）</code>黑盒方法增加日志记录功能，这非常有助于程序调试。然而，此做法只在调试程序时有用。很少有人在调试程序之外的场合用上述“方法调配技术”来永久改动某个类的功能。不能仅仅因为<code>OC</code>语言里有这个特性就一定要用它。若是滥用，反而会令代码变得不易读懂且难于维护。</p>
<h3 id="第-12-条理解类对象的用意">第 12 条：理解“类对象”的用意</h3>
<p><strong>类是一个对象，是<code> Class</code> 类型的对象，简称“类对象”。</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">objc_class</span> <span class="o">*</span><span class="kt">Class</span><span class="p">;</span> 
</code></pre></td></tr></table>
</div>
</div><ul>
<li>类型查询方法：</li>
</ul>
<p>可以用类型信息查询方法来检视类继承体系。<code>“isMemberOfClass:”</code>能够判断出对象是否为某个特定类的实例，而<code>“isKindOfClass:”</code>则能够判断出对象是否为某类或其派生类的实例。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-objc" data-lang="objc"><span class="n">NSMutableDictionary</span> <span class="o">*</span><span class="n">dict</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableDictionary</span> <span class="n">new</span><span class="p">];</span>  
<span class="p">[</span><span class="n">dict</span> <span class="nl">isMemberOfClass</span><span class="p">:[</span><span class="n">NSDictionary</span> <span class="k">class</span><span class="p">]];</span> <span class="c1">///&lt; NO 
</span><span class="c1"></span><span class="p">[</span><span class="n">dict</span> <span class="nl">isMemberOfClass</span><span class="p">:[</span><span class="n">NSMutableDictionary</span> <span class="k">class</span><span class="p">]];</span> <span class="c1">///&lt; YES 
</span><span class="c1"></span><span class="p">[</span><span class="n">dict</span> <span class="nl">isKindOfClass</span><span class="p">:[</span><span class="n">NSDictionary</span> <span class="k">class</span><span class="p">]];</span> <span class="c1">///&lt; YES 
</span><span class="c1"></span><span class="p">[</span><span class="n">dict</span> <span class="nl">isKindOfClass</span><span class="p">:[</span><span class="n">NSArray</span> <span class="k">class</span><span class="p">]];</span> <span class="c1">///&lt; NO 
</span></code></pre></td></tr></table>
</div>
</div><p>比较类对象是否等同的办法来判断，使用<code>==操作符</code>，而不要使用比较<code>OC</code>对象时常用的<code>“isEqual:”</code>方法。原因在于，类对象是<code>“单例”（singleton）</code>，在应用程序范围内，每个类的<code>Class</code>仅有一个实例。</p>
<ul>
<li>要点：
<ul>
<li>每个实例都有一个指向<code>Class</code> 对象的指针，用以表明其类型，而这些 <code>Class</code>对象则构成了类的继承体系。</li>
<li>如果对象类型无法在编译期确定，那么就应该使用类型信息查询方法来探知。</li>
<li>尽量使用类型信息查询方法来确定对象类型，而不要直接比较类对象，因为某些对象可能实现了消息转发功能。</li>
</ul>
</li>
</ul>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<hr>
<p>下一篇：<a href="https://github.com/liuzhongning/Articles/blob/master/contents/previousContents/%E3%80%8AEffective%20%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F%20iOS%20%E4%B8%8E%20OS%20X%20%E4%BB%A3%E7%A0%81%E7%9A%84%2052%20%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0(2).md">iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(2)</a></p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">liupengkun</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2018-11-30
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://liupengkun1993.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a>
          <a href="http://liupengkun1993.github.io/tags/ios/">iOS</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/ios/effective-%E7%BC%96%E5%86%99%E9%AB%98%E8%B4%A8%E9%87%8F-ios-%E4%B8%8E-os-x-%E4%BB%A3%E7%A0%81%E7%9A%84-52-%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B02/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">iOS 开发 -《Effective Objective-C 2.0:编写高质量 iOS 与 OS X 代码的 52 个有效方法》读书笔记(2)</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/ios/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%87%8D%E6%9E%84%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E5%8F%8A-app-%E9%87%8D%E6%9E%84%E5%BF%83%E5%BE%97/">
            <span class="next-text nav-default">设计模式-《重构》读书笔记及 APP 重构心得</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:pengkun1011@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/LiuPengKun1993" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/u/3828401985?is_all=1" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/liu-peng-kun-74-8" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="http://liupengkun1993.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2016 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        liupengkun
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
