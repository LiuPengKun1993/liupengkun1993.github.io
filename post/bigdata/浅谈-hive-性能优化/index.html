<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>浅谈 Hive 性能优化 - liupengkun</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="liupengkun" />
  <meta name="description" content="总结了 Hive 的常用优化手段。 列裁剪及分区裁剪 这是最基本的操作。所谓列裁剪就是在查询时只读取需要的列，分区裁剪就是只读取需要的分区。 比如当列很多或" />

  <meta name="keywords" content="学习, iOS, Coding" />






<meta name="generator" content="Hugo 0.79.0" />


<link rel="canonical" href="https://liupengkun1993.github.io/post/bigdata/%E6%B5%85%E8%B0%88-hive-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f1e506a781bf25d33ffc18aa6b4e972a965c58049d27d4f92b7db2e9bf28e4bf.css" integrity="sha256-8eUGp4G/JdM//Biqa06XKpZcWASdJ9T5K32y6b8o5L8=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="浅谈 Hive 性能优化" />
<meta property="og:description" content="总结了 Hive 的常用优化手段。 列裁剪及分区裁剪 这是最基本的操作。所谓列裁剪就是在查询时只读取需要的列，分区裁剪就是只读取需要的分区。 比如当列很多或" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://liupengkun1993.github.io/post/bigdata/%E6%B5%85%E8%B0%88-hive-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" />
<meta property="article:published_time" content="2020-09-19T15:43:48+08:00" />
<meta property="article:modified_time" content="2020-09-19T15:43:48+08:00" />
<meta itemprop="name" content="浅谈 Hive 性能优化">
<meta itemprop="description" content="总结了 Hive 的常用优化手段。 列裁剪及分区裁剪 这是最基本的操作。所谓列裁剪就是在查询时只读取需要的列，分区裁剪就是只读取需要的分区。 比如当列很多或">
<meta itemprop="datePublished" content="2020-09-19T15:43:48+08:00" />
<meta itemprop="dateModified" content="2020-09-19T15:43:48+08:00" />
<meta itemprop="wordCount" content="4812">



<meta itemprop="keywords" content="大数据,Hive," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="浅谈 Hive 性能优化"/>
<meta name="twitter:description" content="总结了 Hive 的常用优化手段。 列裁剪及分区裁剪 这是最基本的操作。所谓列裁剪就是在查询时只读取需要的列，分区裁剪就是只读取需要的分区。 比如当列很多或"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">以梦为马</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/about/">关于我</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      以梦为马
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://liupengkun1993.github.io/about/">关于我</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">浅谈 Hive 性能优化</h1>
      
      <div class="post-meta">
        <time datetime="2020-09-19" class="post-time">
          2020-09-19
        </time>
        <div class="post-category">
            <a href="https://liupengkun1993.github.io/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/"> 大数据 </a>
            
          </div>
        <span class="more-meta"> 4812 words </span>
          <span class="more-meta"> 10 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#列裁剪及分区裁剪">列裁剪及分区裁剪</a></li>
        <li><a href="#谓词下推">谓词下推</a></li>
        <li><a href="#sort-by-代替-order-by">sort by 代替 order by</a></li>
        <li><a href="#group-by-代替-distinct">group by 代替 distinct</a></li>
        <li><a href="#group-by-配置调整">group by 配置调整</a></li>
        <li><a href="#join-基础优化">join 基础优化</a></li>
        <li><a href="#优化-sql-处理-join-数据倾斜">优化 SQL 处理 join 数据倾斜</a></li>
        <li><a href="#mapreduce-优化">MapReduce 优化</a></li>
        <li><a href="#并行执行与本地模式">并行执行与本地模式</a></li>
        <li><a href="#严格模式">严格模式</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <blockquote>
<p>总结了 Hive 的常用优化手段。</p>
</blockquote>
<h3 id="列裁剪及分区裁剪">列裁剪及分区裁剪</h3>
<p>这是最基本的操作。所谓列裁剪就是在查询时只读取需要的列，分区裁剪就是只读取需要的分区。</p>
<p>比如当列很多或者数据量很大时，如果使用 <code>select * from order_table;</code> 或者不指定分区，全列扫描和全表扫描效率都很低。</p>
<p>这个时候我们可以指定列：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span>
	<span class="n">uid</span><span class="p">,</span>
	<span class="n">price</span>
<span class="k">from</span>
	<span class="n">order_table</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>或者当这个表是分区表的时候，指定分区：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span>
	<span class="n">uid</span><span class="p">,</span>
	<span class="n">price</span>
<span class="k">from</span>
	<span class="n">order_table</span>
<span class="k">where</span>
	<span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200901&#34;</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>Hive 中与列裁剪优化相关的配置项是<code>hive.optimize.cp</code>，与分区裁剪优化相关的则是<code>hive.optimize.pruner</code>，默认都是true。</p>
<h3 id="谓词下推">谓词下推</h3>
<p>在关系型数据库如 MySQL 中，也有谓词下推（Predicate Pushdown，PPD）的概念。就是将 SQL 语句中的 where 谓词逻辑都尽可能提前执行，减少下游处理的数据量。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span>
	<span class="n">a</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span>
	<span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
	<span class="p">...</span>
<span class="k">from</span>
    <span class="n">user_table</span> <span class="n">a</span>
<span class="k">inner</span> <span class="k">join</span>
    <span class="p">(</span><span class="k">select</span>
        <span class="n">uid</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">price</span>
    <span class="k">from</span>
        <span class="n">order_table</span>
    <span class="k">where</span>
        <span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200901&#34;</span>
    <span class="k">and</span>
        <span class="n">paystate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="n">b</span>
<span class="k">on</span>
    <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><p>对 order_table 做过滤的 where 语句写在子查询内部，而不是外部。Hive 中有谓词下推优化的配置项<code>hive.optimize.ppd</code>，默认值true，与它对应的逻辑优化器是 PredicatePushDown。该优化器就是将 OperatorTree 中的 FilterOperator 向上提。</p>
<h3 id="sort-by-代替-order-by">sort by 代替 order by</h3>
<p>HiveSQL 中的 order by 与其他 SQL 方言中的功能一样，就是将结果按某字段全局排序，这会导致所有 map 端数据都进入一个 reducer 中，在数据量大时可能会长时间计算不完。</p>
<p>如果使用 sort by，那么还是会视情况启动多个 reducer 进行排序，并且保证每个 reducer 内局部有序。为了控制 map 端数据分配到 reducer 的 key，往往还要配合 distribute by 一同使用。如果不加 distribute by 的话，map 端数据就会随机分配到 reducer。</p>
<p>举个例子，假如要以 uid 为 key，以订单时间倒序、订单金额倒序输出记录数据：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span>
    <span class="n">uid</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">,</span>
    <span class="n">price</span>
<span class="k">from</span>
    <span class="n">order_table</span>
<span class="k">where</span>
    <span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200901&#34;</span>
<span class="k">and</span>
    <span class="n">paystate</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">distribute</span> <span class="k">by</span> 
    <span class="n">uid</span>
<span class="n">sort</span> <span class="k">by</span> 
    <span class="n">order_time</span> <span class="k">desc</span><span class="p">,</span>
    <span class="n">price</span> <span class="k">desc</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="group-by-代替-distinct">group by 代替 distinct</h3>
<p>数据量较大的情况下，慎用count(distinct)，count(distinct)容易产生倾斜问题</p>
<p>当要统计某一列的去重数时，如果数据量很大，count(distinct) 就会非常慢，原因与 order by 类似，count(distinct) 逻辑只会有很少的 reducer 来处理。这时可以用 group by 来改写：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span> 
    <span class="k">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
<span class="k">from</span> 
    <span class="p">(</span>
        <span class="k">select</span> 
            <span class="n">uid</span> 
        <span class="k">from</span> 
            <span class="n">order_table</span>
        <span class="k">where</span> 
            <span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200901&#34;</span>
        <span class="k">group</span> <span class="k">by</span> 
            <span class="n">uid</span>
    <span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>但是这样写会启动两个 MR job（单纯 distinct 只会启动一个），所以要确保数据量大到启动 job 的 overhead 远小于计算耗时，才考虑这种方法。当数据集很小或者 key 的倾斜比较明显时，group by 还可能会比 distinct 慢。</p>
<h3 id="group-by-配置调整">group by 配置调整</h3>
<h4 id="map-端预聚合">map 端预聚合</h4>
<p>group by 时，如果先起一个 combiner 在 map 端做部分预聚合，可以有效减少 shuffle 数据量。预聚合的配置项是 <code>hive.map.aggr</code>，默认值 true，对应的优化器为 GroupByOptimizer，简单方便。
通过 <code>hive.groupby.mapaggr.checkinterval</code> 参数也可以设置 map 端预聚合的行数阈值，超过该值就会分拆 job，默认值 100000。</p>
<h4 id="倾斜均衡配置项">倾斜均衡配置项</h4>
<p>group by 时如果某些 key 对应的数据量过大，就会发生数据倾斜。Hive 自带了一个均衡数据倾斜的配置项<code>hive.groupby.skewindata</code>，默认值false。
其实现方法是在 group by 时启动两个 MR job。第一个 job 会将 map 端数据随机输入 reducer，每个 reducer 做部分聚合，相同的 key 就会分布在不同的 reducer 中。第二个 job 再将前面预处理过的数据按 key 聚合并输出结果，这样就起到了均衡的效果。</p>
<h3 id="join-基础优化">join 基础优化</h3>
<h4 id="build-table小表前置">build table（小表）前置</h4>
<p>在最常见的 hash join 方法中，一般总有一张相对小的表和一张相对大的表，小表叫 build table，大表叫 probe table。</p>
<p>Hive 在解析带 join 的 SQL 语句时，会默认将最后一个表作为 probe table，将前面的表作为 build table 并试图将它们读进内存。如果表顺序写反，probe table 在前面，引发 OOM 的风险就高了。</p>
<p>在维度建模数据仓库中，事实表就是 probe table，维度表就是 build table。</p>
<h4 id="多表-join-时-key-相同">多表 join 时 key 相同</h4>
<p>这种情况会将多个 join 合并为一个 MR job 来处理：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span>
	<span class="n">a</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span>
	<span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
	<span class="p">...</span>
<span class="k">from</span>
    <span class="n">user_table</span> <span class="n">a</span>
<span class="k">inner</span> <span class="k">join</span>
    <span class="p">(</span><span class="k">select</span>
        <span class="n">uid</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">price</span>
    <span class="k">from</span>
        <span class="n">order_table</span>
    <span class="k">where</span>
        <span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200901&#34;</span>
    <span class="k">and</span>
        <span class="n">paystate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="n">b</span>
<span class="k">on</span>
    <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">inner</span> <span class="k">join</span>
    <span class="n">parent_table</span> <span class="k">c</span>
<span class="k">on</span>  
    <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>

</code></pre></td></tr></table>
</div>
</div><p>如果上面两个 join 的条件不相同，比如改成 <code>a.uid = c.uid</code>，就会拆成两个 MR job 计算。
负责这个的是相关性优化器 CorrelationOptimizer，它的功能除此之外还非常多，逻辑复杂，可以参考 <a href="https://cwiki.apache.org/confluence/display/Hive/Correlation+Optimizer">Hive官方的文档</a>。</p>
<h4 id="利用-map-join-特性">利用 map join 特性</h4>
<p>map join 特别适合大小表 join 的情况。Hive 会将 build table 和 probe table 在 map 端直接完成 join 过程，消灭了 reduce，效率很高。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span>
    <span class="cm">/*+ mapjoin(a) */</span>
	<span class="n">a</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span>
	<span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
	<span class="p">...</span>
<span class="k">from</span>
    <span class="n">user_table</span> <span class="n">a</span>
<span class="k">inner</span> <span class="k">join</span>
    <span class="p">(</span><span class="k">select</span>
        <span class="n">uid</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">price</span>
    <span class="k">from</span>
        <span class="n">order_table</span>
    <span class="k">where</span>
        <span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200901&#34;</span>
    <span class="k">and</span>
        <span class="n">paystate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="n">b</span>
<span class="k">on</span>
    <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="优化-sql-处理-join-数据倾斜">优化 SQL 处理 join 数据倾斜</h3>
<h4 id="空值或无意义值">空值或无意义值</h4>
<p>空值或无意义值很常见，比如日志类型的数据，要统计每天的活跃手机号，但是总有一些日志数据没有收集到手机号，或为空、为 NULL 等，这个时候就需要提前将这些无意义的数据过滤掉，避免消耗。</p>
<h4 id="build-table-过大">build table 过大</h4>
<p>有时，build table 会大到无法直接使用 map join 的地步，比如全量用户维度表，而使用普通 join 又有数据分布不均的问题。这时就要充分利用 probe table 的限制条件，削减 build table 的数据量，再使用 map join 解决。代价就是需要进行两次 join。举个例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span>
    <span class="cm">/*+ mapjoin(aa) */</span>
    <span class="n">aa</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span>
    <span class="n">aa</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
    <span class="p">...</span>
<span class="k">from</span>
    <span class="p">(</span><span class="k">select</span>
        <span class="cm">/*+ mapjoin(a) */</span>
        <span class="n">a</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span>
        <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="p">...</span>
    <span class="k">from</span>
        <span class="n">user_table</span> <span class="n">a</span>
    <span class="k">inner</span> <span class="k">join</span>
        <span class="p">(</span><span class="k">select</span>
            <span class="n">uid</span><span class="p">,</span>
            <span class="n">user_id</span><span class="p">,</span>
            <span class="n">price</span>
        <span class="k">from</span>
            <span class="n">order_table</span>
        <span class="k">where</span>
            <span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200901&#34;</span>
        <span class="k">and</span>
            <span class="n">paystate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="n">b</span>
    <span class="k">on</span>
        <span class="n">a</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span><span class="n">aa</span>
<span class="k">inner</span> <span class="k">join</span>
    <span class="p">(</span><span class="k">select</span>
        <span class="n">uid</span><span class="p">,</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="n">price</span>
    <span class="k">from</span>
        <span class="n">order_table</span>
    <span class="k">where</span>
        <span class="n">pt_date</span> <span class="o">=</span> <span class="s2">&#34;20200902&#34;</span>
    <span class="k">and</span>
        <span class="n">paystate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="n">bb</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="mapreduce-优化">MapReduce 优化</h3>
<h4 id="调整-mapper-数">调整 mapper 数</h4>
<p>mapper 数量与输入文件的 split 数息息相关，在 Hadoop 源码<code>org.apache.hadoop.mapreduce.lib.input.FileInputFormat</code> 类中可以看到 split 划分的具体逻辑。</p>
<p>可以直接通过参数 <code>mapred.map.tasks（默认值2）</code>来设定 mapper 数的期望值，但它不一定会生效，下面会提到。
设输入文件的总大小为 total_input_size。HDFS 中，一个块的大小由参数 dfs.block.size 指定，默认值 64MB 或 128MB。在默认情况下，mapper数就是：
<code>default_mapper_num = total_input_size / dfs.block.size</code>。</p>
<p>参数 <code>mapred.min.split.size（默认值1B）</code>和<code>mapred.max.split.size（默认值64MB）</code>分别用来指定 split 的最小和最大大小。split 大小和 split 数计算规则是：
<code>split_size = MAX(mapred.min.split.size, MIN(mapred.max.split.size, dfs.block.size))</code>；
<code>split_num = total_input_size / split_size</code>。</p>
<p>得出 mapper 数：
<code>mapper_num = MIN(split_num, MAX(default_num, mapred.map.tasks))</code>。</p>
<p>可见，如果想减少 mapper 数，就适当调高 mapred.min.split.size，split 数就减少了。如果想增大 mapper 数，除了降低 mapred.min.split.size 之外，也可以调高 mapred.map.tasks。</p>
<p>一般来讲，如果输入文件是少量大文件，就减少 mapper 数；如果输入文件是大量非小文件，就增大 mapper 数；至于大量小文件的情况，得参考下面“合并小文件”一节的方法处理。</p>
<h4 id="调整-reducer-数">调整 reducer 数</h4>
<p>reducer 数量的确定方法比 mapper 简单得多。使用参数<code>mapred.reduce.tasks</code>可以直接设定 reducer 数量，不像 mapper 一样是期望值。但如果不设这个参数的话，Hive 就会自行推测，逻辑如下：</p>
<p>参数<code>hive.exec.reducers.bytes.per.reducer</code>用来设定每个 reducer 能够处理的最大数据量，默认值 1G（1.2版本之前）或 256M（1.2版本之后）。</p>
<p>参数 <code>hive.exec.reducers.max</code> 用来设定每个 job 的最大 reducer 数量，默认值 999（1.2版本之前）或 1009（1.2版本之后）。</p>
<p>得出 reducer 数：
<code>reducer_num = MIN(total_input_size / reducers.bytes.per.reducer, reducers.max)</code>。</p>
<p>reducer 数量与输出文件的数量相关。如果 reducer 数太多，会产生大量小文件，对 HDFS 造成压力。如果 reducer 数太少，每个 reducer 要处理很多数据，容易拖慢运行时间或者造成 OOM。</p>
<h4 id="合并小文件">合并小文件</h4>
<h5 id="输入阶段合并">输入阶段合并</h5>
<p>需要更改 Hive 的输入文件格式，即参数<code>hive.input.format</code>，默认值是<code>org.apache.hadoop.hive.ql.io.HiveInputFormat</code>，我们改成<code>org.apache.hadoop.hive.ql.io.CombineHiveInputFormat</code>。这样比起上面调整 mapper 数时，又会多出两个参数，分别是<code>mapred.min.split.size.per.node</code>和<code>mapred.min.split.size.per.rack</code>，含义是单节点和单机架上的最小 split 大小。如果发现有 split 大小小于这两个值（默认都是 100MB），则会进行合并。具体逻辑可以参看 Hive 源码中的对应类。</p>
<h5 id="输出阶段合并">输出阶段合并</h5>
<p>直接将 <code>hive.merge.mapfiles</code> 和 <code>hive.merge.mapredfiles</code> 都设为 true 即可，前者表示将 map-only 任务的输出合并，后者表示将 map-reduce 任务的输出合并。另外，<code>hive.merge.size.per.task</code> 可以指定每个task输出后合并文件大小的期望值，<code>hive.merge.size.smallfiles.avgsize</code> 可以指定所有输出文件大小的均值阈值，默认值都是 1GB。如果平均大小不足的话，就会另外启动一个任务来进行合并。</p>
<h4 id="启用压缩">启用压缩</h4>
<p>压缩 job 的中间结果数据和输出数据，可以用少量 CPU 时间节省很多空间。压缩方式一般选择 Snappy，效率最高。</p>
<p>要启用中间压缩，需要设定<code>hive.exec.compress.intermediate</code> 为 true，同时指定压缩方式<code>hive.intermediate.compression.codec</code> 为<code>org.apache.hadoop.io.compress.SnappyCodec</code>。另外，参数<code>hive.intermediate.compression.type</code> 可以选择对块（BLOCK）还是记录（RECORD）压缩，BLOCK的压缩率比较高。
输出压缩的配置基本相同，打开<code>hive.exec.compress.output</code>即可。</p>
<h4 id="jvm-重用">JVM 重用</h4>
<p>在 MR job 中，默认是每执行一个 task 就启动一个 JVM。如果 task 非常小而碎，那么 JVM 启动和关闭的耗时就会很长。可以通过调节参数<code>mapred.job.reuse.jvm.num.tasks</code>来重用。例如将这个参数设成 5，那么就代表同一个 MR job 中顺序执行的 5 个 task 可以重复使用一个 JVM，减少启动和关闭的开销。但它对不同 MR job 中的 task 无效。</p>
<h3 id="并行执行与本地模式">并行执行与本地模式</h3>
<h4 id="并行执行">并行执行</h4>
<p>Hive 中互相没有依赖关系的 job 间是可以并行执行的，最典型的就是多个子查询 union all。在集群资源相对充足的情况下，可以开启并行执行，即将参数hive.exec.parallel设为true。另外hive.exec.parallel.thread.number可以设定并行执行的线程数，默认为8，一般都够用。</p>
<h4 id="本地模式">本地模式</h4>
<p>Hive 也可以不将任务提交到集群进行运算，而是直接在一台节点上处理。因为消除了提交到集群的 overhead，所以比较适合数据量很小，且逻辑不复杂的任务。
设置 <code>hive.exec.mode.local.auto</code> 为 true 可以开启本地模式。但任务的输入数据总量必须小于 <code>hive.exec.mode.local.auto.inputbytes.max（默认值128MB）</code> ，且 mapper 数必须小于 <code>hive.exec.mode.local.auto.tasks.max（默认值4）</code> ，reducer 数必须为 0 或 1，才会真正用本地模式执行。</p>
<h3 id="严格模式">严格模式</h3>
<p>所谓严格模式，就是强制不允许用户执行 3 种有风险的 HiveSQL 语句，一旦执行会直接失败。这 3 种语句是：</p>
<ul>
<li>查询分区表时不限定分区列的语句；</li>
<li>两表 join 产生了笛卡尔积的语句；</li>
<li>用 order by 来排序但没有指定 limit 的语句。</li>
</ul>
<p>要开启严格模式，需要将参数<code>hive.mapred.mode</code>设为 strict。</p>
<h4 id="采用合适的存储格式">采用合适的存储格式</h4>
<p>在 HiveSQL 的 create table 语句中，可以使用 stored as &hellip; 指定表的存储格式。Hive 表支持的存储格式有 TextFile、SequenceFile、RCFile、Avro、ORC、Parquet 等。</p>
<p>存储格式一般需要根据业务进行选择，在我们的实操中，绝大多数表都采用 TextFile 与 Parquet 两种存储格式之一。</p>
<p>TextFile 是最简单的存储格式，它是纯文本记录，也是 Hive 的默认格式。虽然它的磁盘开销比较大，查询效率也低，但它更多地是作为跳板来使用。RCFile、ORC、Parquet 等格式的表都不能由文件直接导入数据，必须由 TextFile 来做中转。</p>
<p>Parquet 和 ORC 都是 Apache 旗下的开源列式存储格式。列式存储比起传统的行式存储更适合批量 OLAP 查询，并且也支持更好的压缩和编码。我们选择 Parquet 的原因主要是它支持 Impala 查询引擎，并且我们对 update、delete 和事务性操作需求很低。</p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">liupengkun</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2020-09-19
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://liupengkun1993.github.io/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>
          <a href="https://liupengkun1993.github.io/tags/hive/">Hive</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/bigdata/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E5%BB%BA%E6%A8%A1%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">数据仓库建模——维度建模</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/bigdata/dataworks-%E9%94%99%E8%AF%AF%E6%B1%87%E6%80%BB/">
            <span class="next-text nav-default">DataWorks 错误汇总</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:pengkun1011@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/LiuPengKun1993" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/u/3828401985?is_all=1" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.zhihu.com/people/liu-peng-kun-74-8" rel="me noopener" class="iconfont"
      title="zhihu"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M351.791182 562.469462l192.945407 0c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262l159.282726 0c0 0-0.86367-67.402109-18.578124-67.402109s-279.979646 0-279.979646 0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461c-4.536316 12.313443 24.62791 5.832845 36.941354 0 12.313443-5.832845 68.050885-25.924439 84.252893-103.69571l86.570681 0c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262L109.86113 490.530013c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449L279.868105 562.469462c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513 0 0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-0.055259 0.185218 167.855986 193.263655c0 0 22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-0.045025 0.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"></path>
  <path d="M584.918753 182.033893l0 668.840094 70.318532 0 28.807093 80.512708 121.875768-80.512708 153.600307 0L959.520453 182.033893 584.918753 182.033893zM887.150192 778.934538l-79.837326 0-99.578949 65.782216-23.537066-65.782216-24.855084 0L659.341766 256.673847l227.807403 0L887.149169 778.934538z"></path>
</svg>

    </a>


<a href="https://liupengkun1993.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2016 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        liupengkun
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
